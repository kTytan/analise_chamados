<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="refresh" content="900">
    <title>Monitoramento Gerencial Oracle (Histórico)</title>
    <style>
        :root {
            --background: #1e1e1e;
            --foreground: #f0f0f0;
            --card-bg: #2c2c2c;
            --accent: #00e676;
            --accent-secondary: #76d7c4;
            --hover: #4a6fa5;
        }

        html, body {
            margin: 0; padding: 0;
            width: 100%; height: 100%;
            font-family: 'Segoe UI', sans-serif;
            background: var(--background);
            color: var(--foreground);
            overflow: hidden;
        }

        body {
            display: flex;
            flex-direction: column;
        }

        .header-tv {
            background: #0d0d0d;
            padding: 12px 20px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.6);
        }

        .header-tv .title {
            font-size: 2em;
            font-weight: 600;
        }

        .header-tv .subtitle {
            font-size: 1em;
            color: #b0b0b0;
        }

        nav {
            background: #121212;
            padding: 10px 0;
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
        }

        nav a {
            color: white;
            text-decoration: none;
            font-size: 1em;
            padding: 8px 16px;
            border-radius: 6px;
            transition: 0.3s;
        }

        nav a.active, nav a:hover {
            background: var(--hover);
        }

        .tv-main-container-gerencial {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 30px;
            align-items: center;
        }

        section {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.4);
            width: 100%;
            max-width: 1600px;
        }

        h2 {
            text-align: center;
            font-size: 1.8em;
            margin-bottom: 20px;
            color: var(--accent);
            border-bottom: 1px solid #444;
            padding-bottom: 8px;
        }

        h3 {
            font-size: 1.3em;
            color: var(--accent-secondary);
            border-bottom: 1px dashed #555;
            margin: 25px 0 15px;
            padding-bottom: 5px;
        }

        .kpi-grid-gerencial, .dbp-kpi-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 30px;
            justify-items: center;
        }

        .kpi-card {
            background: #333;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            width: 250px;
            min-height: 140px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .kpi-card .value {
            font-size: 2.8em;
            font-weight: bold;
            color: #00d9b2;
        }

        .kpi-card .label {
            font-size: 1.2em;
            color: #aaa;
            margin-top: 8px;
            word-wrap: break-word;
            max-width: 90%;
        }

        .kpi-card-link {
            text-decoration: none;
            color: inherit;
        }

        .kpi-card-link:hover .kpi-card {
            transform: translateY(-4px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.4);
        }

        .charts-row-gerencial {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }

        .chart-container-line {
            flex: 1;
            min-width: 400px;
            min-height: 380px;
            background: #2d2d2d;
            border-radius: 8px;
            padding: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .chart-container-line > div {
            width: 100% !important;
            height: 100% !important;
        }

        @media (max-width: 1024px) {
            .kpi-grid-gerencial, .dbp-kpi-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            nav a { font-size: 0.9em; padding: 6px 12px; }
            .kpi-card .value { font-size: 2.2em; }
            .kpi-card .label { font-size: 1em; }
            .kpi-grid-gerencial, .dbp-kpi-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header-tv">
        <span class="title">Dashboard Gerencial</span>
        <span class="subtitle">Serviço: {{ servico_foco }} | Histórico Completo</span>
    </div>
    <nav>
        <a href="{{ url_for('index') }}">Principal</a>
        <a href="{{ url_for('analise_detalhada') }}">Análise Detalhada</a>
        <a href="{{ url_for('dashboard_tv_oracle') }}">TV Oracle Detalhada</a>
        <a href="{{ url_for('dashboard_tv_fornecedores') }}">TV Fornecedores</a>
        <a href="{{ url_for('dashboard_tv_gerencial') }}" class="active">TV Gerencial Oracle</a>
    </nav>

    <div class="tv-main-container-gerencial">
        <section class="kpi-section-gerencial">
            <h2>Visão Geral Oracle (Chamados Ativos e Pendências)</h2>
            <div class="kpi-grid-gerencial">
                
                <a href="{{ url_for('analise_detalhada', servico=servico_foco, status_chamado=STATUS_EM_ATENDIMENTO_LISTA_PARA_LINK, data_inicio=data_inicio_link_historico, data_fim=data_fim_link_historico) }}" target="_blank" class="kpi-card-link" title="Ver todos os chamados 'Em Atendimento'">
                    <div class="kpi-card">
                        <div class="value">{{ kpis_gerais_oracle.em_atendimento | default(0) }}</div>
                        <div class="label">Em Atendimento</div>
                    </div>
                </a>

                <a href="{{ url_for('analise_detalhada', servico=servico_foco, status_chamado=STATUS_AGUARDANDO_SOLICITANTE_STR, data_inicio=data_inicio_link_historico, data_fim=data_fim_link_historico) }}" target="_blank" class="kpi-card-link" title="Ver chamados 'Aguardando Solicitante'">
                    <div class="kpi-card">
                        <div class="value">{{ kpis_gerais_oracle.aguardando_solicitante | default(0) }}</div>
                        <div class="label">Aguardando Solicitante</div>
                    </div>
                </a>
                
                <a href="{{ url_for('analise_detalhada', servico=servico_foco, grupo_solucao=GRUPO_AGUARDANDO_AVALIACAO_NOME, data_inicio=data_inicio_link_historico, data_fim=data_fim_link_historico) }}" target="_blank" class="kpi-card-link" title="Ver chamados no grupo 'Aguardando Avaliação'">
                    <div class="kpi-card">
                        <div class="value">{{ kpis_gerais_oracle.aguardando_avaliacao_grupo | default(0) }}</div>
                        <div class="label">Aguardando Avaliação (Grupo)</div>
                    </div>
                </a>

                <a href="{{ url_for('analise_detalhada', servico=servico_foco, status_chamado=STATUS_CONTESTADO_STR, data_inicio=data_inicio_link_historico, data_fim=data_fim_link_historico) }}" target="_blank" class="kpi-card-link" title="Ver chamados 'Contestado'">
                    <div class="kpi-card">
                        <div class="value">{{ kpis_gerais_oracle.contestados | default(0) }}</div>
                        <div class="label">Contestado</div>
                    </div>
                </a>

                <a href="{{ url_for('analise_detalhada', servico=servico_foco, data_inicio=data_inicio_link_historico, data_fim=data_fim_link_historico) }}" target="_blank" class="kpi-card-link" title="Visualizar chamados ativos (base para este KPI)">
                    <div class="kpi-card">
                        <div class="value">{{ kpis_gerais_oracle.abertos_sem_atendente | default(0) }}</div>
                        <div class="label">Abertos sem Atendente</div>
                    </div>
                </a>
                
                <div class="kpi-card">
                    <div class="value">{{ kpis_gerais_oracle.aging_medio_ativos_str | default("N/A") }}</div>
                    <div class="label">Aging Médio (Ativos)</div>
                </div>
                
                <a href="{{ url_for('analise_detalhada', servico=servico_foco, data_inicio=data_inicio_link_historico, data_fim=data_fim_link_historico) }}" target="_blank" class="kpi-card-link" title="Visualizar todos os chamados do período. O KPI mostra o T. Médio de Atend./Resol. dos Fechados.">
                    <div class="kpi-card">
                        <div class="value">{{ kpis_gerais_oracle.tempo_medio_atend_geral_str | default("N/A") }}</div>
                        <div class="label">T. Médio Atend./Resol. (Fechados)</div>
                    </div>
                </a>

                <a href="{{ url_for('analise_detalhada', servico=servico_foco, data_inicio=data_inicio_link_7_dias, data_fim=data_fim_link_7_dias) }}" target="_blank" class="kpi-card-link" title="Visualizar chamados ativos criados nos últimos 7 dias.">
                    <div class="kpi-card">
                        <div class="value">{{ kpis_gerais_oracle.criados_ativos_ultimos_7_dias | default(0) }}</div>
                        <div class="label">Criados Ativos (Últimos 7 dias)</div>
                    </div>
                </a>
            </div>
        </section>

        {% if incidentes_12m_graph_html or reqserv_12m_graph_html %}
        <section class="chart-section-gerencial">
            <h2>Evolução Mensal (Últimos 12 Períodos - Serviço Oracle)</h2>
            <div class="charts-row-gerencial">
                {% if incidentes_12m_graph_html %}
                    <div class="chart-container-line">
                        {{ incidentes_12m_graph_html|safe }}
                    </div>
                {% endif %}
                {% if reqserv_12m_graph_html %}
                    <div class="chart-container-line">
                        {{ reqserv_12m_graph_html|safe }}
                    </div>
                {% endif %}
            </div>
        </section>
        {% endif %}

        <section class="dbp-kpi-section">
            <h2>KPIs por Grupo DBP (Chamados Ativos - Todos Serviços)</h2>
            {% if kpis_grupos_dbp %}
                {% for grupo_nome in LISTA_GRUPOS_DBP_PARA_TEMPLATE %}
                    {% set dados_grupo = kpis_grupos_dbp.get(grupo_nome, {}) %}
                    <h3>{{ grupo_nome }}</h3>
                    <div class="dbp-kpi-grid">
                        <a href="{{ url_for('analise_detalhada', grupo_solucao=grupo_nome, status_chamado=STATUS_EM_ATENDIMENTO_LISTA_PARA_LINK, data_inicio=data_inicio_link_historico, data_fim=data_fim_link_historico) }}" target="_blank" class="kpi-card-link">
                            <div class="kpi-card">
                                <div class="value">{{ dados_grupo.em_atendimento | default(0) }}</div>
                                <div class="label">Em Atendimento</div>
                            </div>
                        </a>
                        <a href="{{ url_for('analise_detalhada', grupo_solucao=grupo_nome, status_chamado=STATUS_AGUARDANDO_SOLICITANTE_STR, data_inicio=data_inicio_link_historico, data_fim=data_fim_link_historico) }}" target="_blank" class="kpi-card-link">
                            <div class="kpi-card">
                                <div class="value">{{ dados_grupo.aguardando_solicitante | default(0) }}</div>
                                <div class="label">Aguard. Solicitante</div>
                            </div>
                        </a>
                        <a href="{{ url_for('analise_detalhada', grupo_solucao=grupo_nome, status_chamado=STATUS_CONTESTADO_STR, data_inicio=data_inicio_link_historico, data_fim=data_fim_link_historico) }}" target="_blank" class="kpi-card-link">
                            <div class="kpi-card">
                                <div class="value">{{ dados_grupo.contestado | default(0) }}</div>
                                <div class="label">Contestado</div>
                            </div>
                        </a>
                        <a href="{{ url_for('analise_detalhada', grupo_solucao=grupo_nome, data_inicio=data_inicio_link_historico, data_fim=data_fim_link_historico) }}" target="_blank" class="kpi-card-link">
                            <div class="kpi-card">
                                <div class="value">{{ dados_grupo.aberto_sem_atendente | default(0) }}</div>
                                <div class="label">Abertos sem Atendente</div>
                            </div>
                        </a>
                    </div>
                {% endfor %}
            {% else %}
                <p style="text-align:center;">Nenhum dado para grupos DBP no período.</p>
            {% endif %}
        </section>
    </div>
</body>
</html>